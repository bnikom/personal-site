{"ast":null,"code":"import _slicedToArray from \"/Users/bnikom/Sites/personal-site/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/bnikom/Sites/personal-site/client/src/components/ImageZoom.js\";\n\n/* eslint react/jsx-filename-extension: 0 */\n\n/**\n * (bnikom) code based on\n * 1. https://www.npmjs.com/package/react-image-viewer-zoom\n * [this npm package doesn't have a github associated with it so use\n * https://github.com/EslamNasser/react-image-viewer-zoom]\n * 2. https://www.npmjs.com/package/react-responsive-pinch-zoom-pan\n */\nimport React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport { string } from 'prop-types';\nimport { Col, Row } from 'react-bootstrap';\nconst ZOOM_LEVEL = {\n  MIN: 1,\n  MAX: 4\n};\nconst OFFSET_DEFAULT = {\n  x: 0,\n  y: 0\n};\n\nconst ImageZoom = ({\n  imgUrl,\n  imgTitle\n}) => {\n  // static getDerivedStateFromProps(props, state) {\n  //   if (props.imgUrl !== state.imgUrl) {\n  //     return {\n  //       zoom: ZOOM_LEVEL.MIN,\n  //       offset: OFFSET_DEFAULT,\n  //       imgUrl: props.imgUrl,\n  //     };\n  //   }\n  //   return null;\n  // }\n  const _useState = useState(ZOOM_LEVEL.MIN),\n        _useState2 = _slicedToArray(_useState, 2),\n        zoom = _useState2[0],\n        setZoom = _useState2[1];\n\n  const _useState3 = useState(OFFSET_DEFAULT),\n        _useState4 = _slicedToArray(_useState3, 2),\n        offset = _useState4[0],\n        setOffset = _useState4[1];\n\n  const offsetRange = OFFSET_DEFAULT;\n  const clientOffset = {\n    x: undefined,\n    y: undefined\n  };\n  useEffect(() => {\n    document.addEventListener('mousedown', e => this.handleClickOutside(e)); // Specify how to clean up after this effect:\n\n    return function cleanup() {\n      document.removeEventListener('mousedown', e => this.handleClickOutside(e));\n    };\n  });\n\n  const onMoveStart = e => {\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    draggable = true;\n  };\n\n  const onMove = e => {\n    if (!e.clientX && !e.clientY || zoom === 1 || !draggable) {\n      return;\n    }\n\n    const browserOffset = {\n      x: e.clientX - clientOffset.x || 0,\n      y: e.clientY - clientOffset.y || 0\n    };\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    setOffset({\n      x: offset.x + browserOffset.x,\n      y: offset.y + browserOffset.y\n    });\n  };\n\n  const onMoveEnd = () => {\n    draggable = false;\n    let x = offset.x;\n    let y = offset.y;\n\n    if (Math.abs(offset.x) >= offsetRange.x) {\n      x = offset.x < 0 ? Math.min(0, -offsetRange.x) : Math.max(0, offsetRange.x);\n    }\n\n    if (Math.abs(offset.y) >= offsetRange.y) {\n      y = offset.y < 0 ? Math.min(0, -offsetRange.y) : Math.max(0, offsetRange.y);\n    }\n\n    setOffset({\n      x,\n      y\n    });\n  }; // TODO: new error image api\n\n\n  const onImageError = e => {\n    const imgUrl = this.props.imgUrl;\n    const largeURl = imgUrl.replace('_original', '');\n    e.target.src = largeURl;\n  };\n\n  const setOffsetRange = () => {\n    /**\n     * (bnikom) let's explain my logic here, shall we?\n     *\n     * 2 formulas:\n     * 1. (zoom * length) - (length * (((zoom - 1)/2) + 1))\n     * 2. (length * (((zoom - 1)/2) + 1)) - length\n     *\n     * (zoom - 1): the scale starts at 1, but initial image should not move at scale == 1\n     * we need our calculations to start at 0 #IndexStartsAt0\n     *\n     * (zoom - 1) / 2: when you increase zoom, you are adding 0.5 to each side\n     * ex. increasing the zoom from 1 to 2, you're adding 0.5 to each side\n     *\n     * (1 + ((zoom - 1) / 2): adding the initia1 (100%) of the starting scale\n     *\n     * length * (1 + ((zoom - 1) / 2): multiply by original length to find offset\n     *\n     * (length * (((zoom - 1)/2) + 1)): length - to find out our offset we need to subtract the original length\n     * and see how much we have to move\n     *               OR\n     * (zoom * length) - (length * (((zoom - 1)/2) + 1)): subract calculated width from width of zoomed pic\n    */\n    const dx = this.container.offsetWidth * (1 + (zoom - 1) / 2) - this.container.offsetWidth;\n    const dy = this.container.offsetHeight * (1 + (zoom - 1) / 2) - this.container.offsetHeight;\n    this.offsetRange = {\n      x: Math.max(0, dx),\n      y: Math.max(0, dy)\n    };\n  };\n\n  const resetOffset = () => {\n    setOffset(OFFSET_DEFAULT);\n  };\n\n  const zoomImg = e => {\n    if (e.deltaY > 0) {\n      zoomIn(0.1);\n      e.preventDefault();\n    } else if (e.deltaY < 0) {\n      zoomOut(0.1);\n      e.preventDefault();\n    }\n  };\n\n  const zoomIn = level => {\n    setZoom(Math.min(zoom + level, ZOOM_LEVEL.MAX));\n    setOffset(OFFSET_DEFAULT); // TODO: POTENTIAL CALLBACK NEEDED\n\n    setOffsetRange(); // this.setState({ zoom: Math.min(this.state.zoom + level, ZOOM_LEVEL.MAX), offset: OFFSET_DEFAULT }, () => {\n    //   this.setOffsetRange();\n    // });\n  };\n\n  const zoomOut = level => {\n    if (Math.max(1, zoom - level) > 1) {\n      // this.setState({ zoom: Math.max(1, this.state.zoom - level), offset: OFFSET_DEFAULT }, () => {\n      //   this.setOffsetRange();\n      // });\n      setZoom(Math.max(1, this.state.zoom - level));\n      setOffset(OFFSET_DEFAULT);\n      this.setOffsetRange();\n    } else {\n      setZoom(Math.max(1, this.state.zoom - level));\n      resetOffset(); // this.setState({ zoom: Math.max(1, this.state.zoom - level) }, () => {\n      //   this.resetOffset();\n      // });\n    }\n  };\n\n  handleClickOutside = e => {\n    // (bnikom) finding the modal parent of the react component\n    const modalBody = document.body.querySelector('#modalImgBody');\n\n    if (modalBody && !modalBody.contains(e.target)) {\n      // (bnikom) I want this to re-render when then modal is closed, so it doesn't look strange\n      // setTimeout(() => this.setState({ zoom: ZOOM_LEVEL.MIN, offset: OFFSET_DEFAULT }), 200);\n      setTimeout(() => {\n        setZoom(ZOOM_LEVEL.MIN), setOffset(OFFSET_DEFAULT);\n      }, 200);\n    }\n  };\n\n  const value = \"translate3d(\".concat(offset.x, \"px, \").concat(offset.y, \"px, 0px) scale(\").concat(zoom, \")\");\n  return React.createElement(Row, {\n    className: \"main-img-row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }, React.createElement(Col, {\n    className: \"tool-bar col-xs-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, React.createElement(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }, React.createElement(Col, {\n    className: \"zoom-button-group align-middle col-xs-6\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"zoom-in btn\",\n    onClick: () => zoomIn(1),\n    disabled: zoom >= ZOOM_LEVEL.MAX,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"fa fa-search-plus fa-2x\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201\n    },\n    __self: this\n  })), React.createElement(\"button\", {\n    className: \"zoom-out btn\",\n    onClick: () => zoomOut(1),\n    disabled: zoom <= ZOOM_LEVEL.MIN,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"fa fa-search-minus fa-2x\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }))))), React.createElement(Col, {\n    className: \"image-viewer col-xs-11 pull-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"image-wrapper block img-popup\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"image-outer\",\n    role: \"presentation\",\n    draggable: false,\n    onDragStart: e => e.preventDefault(),\n    onMouseMove: e => onMove(e),\n    onMouseDown: e => onMoveStart(e),\n    onMouseUp: e => onMoveEnd(e),\n    onWheel: e => zoomImg(e),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    className: \"reactImg\",\n    id: \"imgPopup\",\n    ref: container => {\n      this.container = container;\n    },\n    src: imgUrl,\n    onError: e => onImageError(e),\n    alt: imgTitle,\n    style: {\n      cursor: zoom > 1 ? 'all-scroll' : 'default',\n      transform: value\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225\n    },\n    __self: this\n  })))));\n};\n\nexport default ImageZoom; // function imageZoom(imgUrl, imgTitle) {\n//   if (document.getElementById('reactField')) {\n//     ReactDOM.render(\n//       <ImageZoom\n//         imgUrl={imgUrl}\n//         imgTitle={imgTitle}\n//       />, document.getElementById('reactField')\n//     );\n//   }\n// }\n// module.exports = imageZoom;","map":{"version":3,"sources":["/Users/bnikom/Sites/personal-site/client/src/components/ImageZoom.js"],"names":["React","useState","useEffect","ReactDOM","string","Col","Row","ZOOM_LEVEL","MIN","MAX","OFFSET_DEFAULT","x","y","ImageZoom","imgUrl","imgTitle","zoom","setZoom","offset","setOffset","offsetRange","clientOffset","undefined","document","addEventListener","e","handleClickOutside","cleanup","removeEventListener","onMoveStart","clientX","clientY","draggable","onMove","browserOffset","onMoveEnd","Math","abs","min","max","onImageError","props","largeURl","replace","target","src","setOffsetRange","dx","container","offsetWidth","dy","offsetHeight","resetOffset","zoomImg","deltaY","zoomIn","preventDefault","zoomOut","level","state","modalBody","body","querySelector","contains","setTimeout","value","cursor","transform"],"mappings":"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","sourcesContent":["/* eslint react/jsx-filename-extension: 0 */\n/**\n * (bnikom) code based on\n * 1. https://www.npmjs.com/package/react-image-viewer-zoom\n * [this npm package doesn't have a github associated with it so use\n * https://github.com/EslamNasser/react-image-viewer-zoom]\n * 2. https://www.npmjs.com/package/react-responsive-pinch-zoom-pan\n */\n\nimport React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport { string } from 'prop-types';\nimport { Col, Row } from 'react-bootstrap';\n\nconst ZOOM_LEVEL = {\n  MIN: 1,\n  MAX: 4,\n};\n\nconst OFFSET_DEFAULT = {\n  x: 0,\n  y: 0,\n};\n\nconst ImageZoom = ({ imgUrl, imgTitle }) => {\n  // static getDerivedStateFromProps(props, state) {\n  //   if (props.imgUrl !== state.imgUrl) {\n  //     return {\n  //       zoom: ZOOM_LEVEL.MIN,\n  //       offset: OFFSET_DEFAULT,\n  //       imgUrl: props.imgUrl,\n  //     };\n  //   }\n  //   return null;\n  // }\n\n  const [zoom, setZoom] = useState(ZOOM_LEVEL.MIN);\n  const [offset, setOffset] = useState(OFFSET_DEFAULT);\n\n  const offsetRange = OFFSET_DEFAULT;\n  const clientOffset = {\n    x: undefined,\n    y: undefined,\n  };\n\n  useEffect(() => {\n    document.addEventListener('mousedown', e => this.handleClickOutside(e));\n\n    // Specify how to clean up after this effect:\n    return function cleanup() {\n      document.removeEventListener('mousedown', e => this.handleClickOutside(e));\n    };\n  });\n\n  const onMoveStart = (e) => {\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n    draggable = true;\n  }\n\n  const onMove = (e) => {\n    if ((!e.clientX && !e.clientY) || zoom === 1 || !draggable) {\n      return;\n    }\n    const browserOffset = {\n      x: (e.clientX - clientOffset.x) || 0,\n      y: (e.clientY - clientOffset.y) || 0,\n    };\n\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n\n    setOffset({ x: offset.x + browserOffset.x, y: offset.y + browserOffset.y })\n  }\n\n  const onMoveEnd = () => {\n    draggable = false;\n    let x = offset.x;\n    let y = offset.y;\n    if (Math.abs(offset.x) >= offsetRange.x) {\n      x = offset.x < 0 ? Math.min(0, -(offsetRange.x)) : Math.max(0, offsetRange.x);\n    }\n    if (Math.abs(offset.y) >= offsetRange.y) {\n      y = offset.y < 0 ? Math.min(0, -(offsetRange.y)) : Math.max(0, offsetRange.y);\n    }\n    setOffset({ x, y });\n  }\n\n  // TODO: new error image api\n  const onImageError = (e) => {\n    const { imgUrl } = this.props;\n    const largeURl = imgUrl.replace('_original', '');\n    e.target.src = largeURl;\n  }\n\n  const setOffsetRange = () => {\n    /**\n     * (bnikom) let's explain my logic here, shall we?\n     *\n     * 2 formulas:\n     * 1. (zoom * length) - (length * (((zoom - 1)/2) + 1))\n     * 2. (length * (((zoom - 1)/2) + 1)) - length\n     *\n     * (zoom - 1): the scale starts at 1, but initial image should not move at scale == 1\n     * we need our calculations to start at 0 #IndexStartsAt0\n     *\n     * (zoom - 1) / 2: when you increase zoom, you are adding 0.5 to each side\n     * ex. increasing the zoom from 1 to 2, you're adding 0.5 to each side\n     *\n     * (1 + ((zoom - 1) / 2): adding the initia1 (100%) of the starting scale\n     *\n     * length * (1 + ((zoom - 1) / 2): multiply by original length to find offset\n     *\n     * (length * (((zoom - 1)/2) + 1)): length - to find out our offset we need to subtract the original length\n     * and see how much we have to move\n     *               OR\n     * (zoom * length) - (length * (((zoom - 1)/2) + 1)): subract calculated width from width of zoomed pic\n    */\n\n    const dx = (this.container.offsetWidth * (1 + ((zoom - 1) / 2))) - this.container.offsetWidth;\n    const dy = (this.container.offsetHeight * (1 + ((zoom - 1) / 2))) - this.container.offsetHeight;\n    this.offsetRange = {\n      x: Math.max(0, dx),\n      y: Math.max(0, dy),\n    };\n  }\n\n  const resetOffset = () => {\n    setOffset(OFFSET_DEFAULT);\n  }\n\n  const zoomImg = e => {\n    if (e.deltaY > 0) {\n      zoomIn(0.1);\n      e.preventDefault();\n    } else if (e.deltaY < 0) {\n      zoomOut(0.1);\n      e.preventDefault();\n    }\n  }\n\n  const zoomIn = (level) => {\n    setZoom(Math.min(zoom + level, ZOOM_LEVEL.MAX));\n    setOffset(OFFSET_DEFAULT);\n\n    // TODO: POTENTIAL CALLBACK NEEDED\n    setOffsetRange();\n    // this.setState({ zoom: Math.min(this.state.zoom + level, ZOOM_LEVEL.MAX), offset: OFFSET_DEFAULT }, () => {\n    //   this.setOffsetRange();\n    // });\n  }\n\n  const zoomOut = (level) => {\n    if (Math.max(1, zoom - level) > 1) {\n\n      // this.setState({ zoom: Math.max(1, this.state.zoom - level), offset: OFFSET_DEFAULT }, () => {\n      //   this.setOffsetRange();\n      // });\n      setZoom(Math.max(1, this.state.zoom - level));\n      setOffset(OFFSET_DEFAULT);\n\n      this.setOffsetRange();\n    } else {\n      setZoom(Math.max(1, this.state.zoom - level));\n      resetOffset();\n      // this.setState({ zoom: Math.max(1, this.state.zoom - level) }, () => {\n      //   this.resetOffset();\n      // });\n    }\n  }\n\n  handleClickOutside = (e) => {\n    // (bnikom) finding the modal parent of the react component\n    const modalBody = document.body.querySelector('#modalImgBody');\n\n    if (modalBody && !modalBody.contains(e.target)) {\n      // (bnikom) I want this to re-render when then modal is closed, so it doesn't look strange\n      // setTimeout(() => this.setState({ zoom: ZOOM_LEVEL.MIN, offset: OFFSET_DEFAULT }), 200);\n      setTimeout(() => { setZoom(ZOOM_LEVEL.MIN), setOffset(OFFSET_DEFAULT) }, 200);\n    }\n  }\n\n  const value = `translate3d(${offset.x}px, ${offset.y}px, 0px) scale(${zoom})`;\n\n  return (\n    <Row className=\"main-img-row\">\n      <Col\n        className=\"tool-bar col-xs-1\"\n      >\n        <Row>\n          <Col className=\"zoom-button-group align-middle col-xs-6\">\n            <button\n              className=\"zoom-in btn\"\n              onClick={() => zoomIn(1)}\n              disabled={zoom >= ZOOM_LEVEL.MAX}\n            >\n              <span className=\"fa fa-search-plus fa-2x\" />\n            </button>\n            <button\n              className=\"zoom-out btn\"\n              onClick={() => zoomOut(1)}\n              disabled={zoom <= ZOOM_LEVEL.MIN}\n            >\n              <span className=\"fa fa-search-minus fa-2x\" />\n            </button>\n          </Col>\n        </Row>\n      </Col>\n      <Col className=\"image-viewer col-xs-11 pull-right\">\n        <div className=\"image-wrapper block img-popup\">\n          <div\n            className=\"image-outer\"\n            role=\"presentation\"\n            draggable={false}\n            onDragStart={e => e.preventDefault()}\n            onMouseMove={e => onMove(e)}\n            onMouseDown={e => onMoveStart(e)}\n            onMouseUp={e => onMoveEnd(e)}\n            onWheel={e => zoomImg(e)}\n          >\n            <img\n              className=\"reactImg\"\n              id=\"imgPopup\"\n              ref={(container) => { this.container = container; }}\n              src={imgUrl}\n              onError={e => onImageError(e)}\n              alt={imgTitle}\n              style={{ cursor: zoom > 1 ? 'all-scroll' : 'default', transform: value }}\n            />\n          </div>\n        </div>\n      </Col>\n    </Row>\n  );\n}\n\nexport default ImageZoom;\n\n// function imageZoom(imgUrl, imgTitle) {\n//   if (document.getElementById('reactField')) {\n//     ReactDOM.render(\n//       <ImageZoom\n//         imgUrl={imgUrl}\n//         imgTitle={imgTitle}\n//       />, document.getElementById('reactField')\n//     );\n//   }\n// }\n\n// module.exports = imageZoom;\n"]},"metadata":{},"sourceType":"module"}