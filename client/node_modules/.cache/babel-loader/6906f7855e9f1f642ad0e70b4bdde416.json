{"ast":null,"code":"import _slicedToArray from \"/Users/bnikom/Sites/personal-site/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/bnikom/Sites/personal-site/client/src/components/ImageZoom.js\";\n\n/* eslint react/jsx-filename-extension: 0 */\n\n/**\n * (bnikom) code based on\n * 1. https://www.npmjs.com/package/react-image-viewer-zoom\n * [this npm package doesn't have a github associated with it so use\n * https://github.com/EslamNasser/react-image-viewer-zoom]\n * 2. https://www.npmjs.com/package/react-responsive-pinch-zoom-pan\n */\nimport React, { useState, useEffect, useRef } from 'react';\nimport ReactDOM from 'react-dom';\nimport { string } from 'prop-types';\nimport { Col, Row } from 'reactstrap';\nconst ZOOM_LEVEL = {\n  MIN: 1,\n  MAX: 4\n};\nconst OFFSET_DEFAULT = {\n  x: 0,\n  y: 0\n};\n\nconst ImageZoom = ({\n  imgUrl,\n  imgTitle\n}) => {\n  // static getDerivedStateFromProps(props, state) {\n  //   if (props.imgUrl !== state.imgUrl) {\n  //     return {\n  //       zoom: ZOOM_LEVEL.MIN,\n  //       offset: OFFSET_DEFAULT,\n  //       imgUrl: props.imgUrl,\n  //     };\n  //   }\n  //   return null;\n  // }\n  const _useState = useState(ZOOM_LEVEL.MIN),\n        _useState2 = _slicedToArray(_useState, 2),\n        zoom = _useState2[0],\n        setZoom = _useState2[1];\n\n  const _useState3 = useState(OFFSET_DEFAULT),\n        _useState4 = _slicedToArray(_useState3, 2),\n        offset = _useState4[0],\n        setOffset = _useState4[1];\n\n  let offsetRange = OFFSET_DEFAULT;\n  let clientOffset = {\n    x: undefined,\n    y: undefined\n  };\n  let draggable = undefined;\n  useEffect(() => {\n    document.addEventListener('mousedown', e => handleClickOutside(e)); // Specify how to clean up after this effect:\n\n    return function cleanup() {\n      document.removeEventListener('mousedown', e => handleClickOutside(e));\n    };\n  });\n  const imgEl = useRef(null);\n\n  const onMoveStart = e => {\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    draggable = true;\n  };\n\n  const onMove = e => {\n    if (!e.clientX && !e.clientY || zoom === 1 || !draggable) {\n      return;\n    }\n\n    const browserOffset = {\n      x: e.clientX - clientOffset.x || 0,\n      y: e.clientY - clientOffset.y || 0\n    };\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    setOffset({\n      x: offset.x + browserOffset.x,\n      y: offset.y + browserOffset.y\n    });\n  };\n\n  const onMoveEnd = () => {\n    draggable = false;\n    let x = offset.x;\n    let y = offset.y;\n\n    if (Math.abs(offset.x) >= offsetRange.x) {\n      x = offset.x < 0 ? Math.min(0, -offsetRange.x) : Math.max(0, offsetRange.x);\n    }\n\n    if (Math.abs(offset.y) >= offsetRange.y) {\n      y = offset.y < 0 ? Math.min(0, -offsetRange.y) : Math.max(0, offsetRange.y);\n    }\n\n    setOffset({\n      x,\n      y\n    });\n  }; // TODO: new error image api\n\n\n  const onImageError = e => {\n    const imgUrl = this.props.imgUrl;\n    const largeURl = imgUrl.replace('_original', '');\n    e.target.src = largeURl;\n  };\n\n  const setOffsetRange = () => {\n    /**\n     * (bnikom) let's explain my logic here, shall we?\n     *\n     * 2 formulas:\n     * 1. (zoom * length) - (length * (((zoom - 1)/2) + 1))\n     * 2. (length * (((zoom - 1)/2) + 1)) - length\n     *\n     * (zoom - 1): the scale starts at 1, but initial image should not move at scale == 1\n     * we need our calculations to start at 0 #IndexStartsAt0\n     *\n     * (zoom - 1) / 2: when you increase zoom, you are adding 0.5 to each side\n     * ex. increasing the zoom from 1 to 2, you're adding 0.5 to each side\n     *\n     * (1 + ((zoom - 1) / 2): adding the initia1 (100%) of the starting scale\n     *\n     * length * (1 + ((zoom - 1) / 2): multiply by original length to find offset\n     *\n     * (length * (((zoom - 1)/2) + 1)): length - to find out our offset we need to subtract the original length\n     * and see how much we have to move\n     *               OR\n     * (zoom * length) - (length * (((zoom - 1)/2) + 1)): subract calculated width from width of zoomed pic\n    */\n    const dx = imgEl.offsetWidth * (1 + (zoom - 1) / 2) - imgEl.offsetWidth;\n    const dy = imgEl.offsetHeight * (1 + (zoom - 1) / 2) - imgEl.offsetHeight;\n    offsetRange = {\n      x: Math.max(0, dx),\n      y: Math.max(0, dy)\n    };\n  };\n\n  const resetOffset = () => {\n    setOffset(OFFSET_DEFAULT);\n  };\n\n  const zoomImg = e => {\n    if (e.deltaY > 0) {\n      zoomIn(0.1);\n      e.preventDefault();\n    } else if (e.deltaY < 0) {\n      zoomOut(0.1);\n      e.preventDefault();\n    }\n  };\n\n  const zoomIn = level => {\n    setZoom(Math.min(zoom + level, ZOOM_LEVEL.MAX));\n    setOffset(OFFSET_DEFAULT); // TODO: POTENTIAL CALLBACK NEEDED\n\n    setOffsetRange(); // this.setState({ zoom: Math.min(this.state.zoom + level, ZOOM_LEVEL.MAX), offset: OFFSET_DEFAULT }, () => {\n    //   this.setOffsetRange();\n    // });\n  };\n\n  const zoomOut = level => {\n    if (Math.max(1, zoom - level) > 1) {\n      // this.setState({ zoom: Math.max(1, this.state.zoom - level), offset: OFFSET_DEFAULT }, () => {\n      //   this.setOffsetRange();\n      // });\n      setZoom(Math.max(1, zoom - level));\n      setOffset(OFFSET_DEFAULT);\n      setOffsetRange();\n    } else {\n      setZoom(Math.max(1, zoom - level));\n      resetOffset(); // this.setState({ zoom: Math.max(1, this.state.zoom - level) }, () => {\n      //   this.resetOffset();\n      // });\n    }\n  };\n\n  const handleClickOutside = e => {\n    // (bnikom) finding the modal parent of the react component\n    const modalBody = document.body.querySelector('#modalImgBody');\n\n    if (modalBody && !modalBody.contains(e.target)) {\n      // (bnikom) I want this to re-render when then modal is closed, so it doesn't look strange\n      // setTimeout(() => this.setState({ zoom: ZOOM_LEVEL.MIN, offset: OFFSET_DEFAULT }), 200);\n      setTimeout(() => setZoom(ZOOM_LEVEL.MIN), setOffset(OFFSET_DEFAULT), 200);\n    }\n  };\n\n  const value = \"translate3d(\".concat(offset.x, \"px, \").concat(offset.y, \"px, 0px) scale(\").concat(zoom, \")\");\n  return React.createElement(Row, {\n    className: \"main-img-row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }, React.createElement(Col, {\n    className: \"tool-bar col-xs-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }, React.createElement(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }, React.createElement(Col, {\n    className: \"zoom-button-group align-middle col-xs-6\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"zoom-in btn\",\n    onClick: () => zoomIn(1),\n    disabled: zoom >= ZOOM_LEVEL.MAX,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"fa fa-search-plus fa-2x\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  })), React.createElement(\"button\", {\n    className: \"zoom-out btn\",\n    onClick: () => zoomOut(1),\n    disabled: zoom <= ZOOM_LEVEL.MIN,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"fa fa-search-minus fa-2x\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }))))), React.createElement(Col, {\n    className: \"image-viewer col-xs-11 pull-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"image-wrapper block img-popup\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"image-outer\",\n    role: \"presentation\",\n    draggable: false,\n    onDragStart: e => e.preventDefault(),\n    onMouseMove: e => onMove(e),\n    onMouseDown: e => onMoveStart(e),\n    onMouseUp: e => onMoveEnd(e),\n    onWheel: e => zoomImg(e),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    className: \"reactImg\",\n    id: \"imgPopup\",\n    ref: imgEl,\n    src: imgUrl,\n    onError: e => onImageError(e),\n    alt: imgTitle,\n    style: {\n      cursor: zoom > 1 ? 'all-scroll' : 'default',\n      transform: value\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228\n    },\n    __self: this\n  })))));\n};\n\nexport default ImageZoom; // function imageZoom(imgUrl, imgTitle) {\n//   if (document.getElementById('reactField')) {\n//     ReactDOM.render(\n//       <ImageZoom\n//         imgUrl={imgUrl}\n//         imgTitle={imgTitle}\n//       />, document.getElementById('reactField')\n//     );\n//   }\n// }\n// module.exports = imageZoom;","map":{"version":3,"sources":["/Users/bnikom/Sites/personal-site/client/src/components/ImageZoom.js"],"names":["React","useState","useEffect","useRef","ReactDOM","string","Col","Row","ZOOM_LEVEL","MIN","MAX","OFFSET_DEFAULT","x","y","ImageZoom","imgUrl","imgTitle","zoom","setZoom","offset","setOffset","offsetRange","clientOffset","undefined","draggable","document","addEventListener","e","handleClickOutside","cleanup","removeEventListener","imgEl","onMoveStart","clientX","clientY","onMove","browserOffset","onMoveEnd","Math","abs","min","max","onImageError","props","largeURl","replace","target","src","setOffsetRange","dx","offsetWidth","dy","offsetHeight","resetOffset","zoomImg","deltaY","zoomIn","preventDefault","zoomOut","level","modalBody","body","querySelector","contains","setTimeout","value","cursor","transform"],"mappings":"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","sourcesContent":["/* eslint react/jsx-filename-extension: 0 */\n/**\n * (bnikom) code based on\n * 1. https://www.npmjs.com/package/react-image-viewer-zoom\n * [this npm package doesn't have a github associated with it so use\n * https://github.com/EslamNasser/react-image-viewer-zoom]\n * 2. https://www.npmjs.com/package/react-responsive-pinch-zoom-pan\n */\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport ReactDOM from 'react-dom';\nimport { string } from 'prop-types';\nimport { Col, Row } from 'reactstrap';\n\nconst ZOOM_LEVEL = {\n  MIN: 1,\n  MAX: 4,\n};\n\nconst OFFSET_DEFAULT = {\n  x: 0,\n  y: 0,\n};\n\nconst ImageZoom = ({ imgUrl, imgTitle }) => {\n  // static getDerivedStateFromProps(props, state) {\n  //   if (props.imgUrl !== state.imgUrl) {\n  //     return {\n  //       zoom: ZOOM_LEVEL.MIN,\n  //       offset: OFFSET_DEFAULT,\n  //       imgUrl: props.imgUrl,\n  //     };\n  //   }\n  //   return null;\n  // }\n\n  const [zoom, setZoom] = useState(ZOOM_LEVEL.MIN);\n  const [offset, setOffset] = useState(OFFSET_DEFAULT);\n\n  let offsetRange = OFFSET_DEFAULT;\n  let clientOffset = {\n    x: undefined,\n    y: undefined,\n  };\n  let draggable = undefined;\n\n  useEffect(() => {\n    document.addEventListener('mousedown', e => handleClickOutside(e));\n\n    // Specify how to clean up after this effect:\n    return function cleanup() {\n      document.removeEventListener('mousedown', e => handleClickOutside(e));\n    };\n  });\n\n  const imgEl = useRef(null);\n\n  const onMoveStart = (e) => {\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n    draggable = true;\n  }\n\n  const onMove = (e) => {\n    if ((!e.clientX && !e.clientY) || zoom === 1 || !draggable) {\n      return;\n    }\n    const browserOffset = {\n      x: (e.clientX - clientOffset.x) || 0,\n      y: (e.clientY - clientOffset.y) || 0,\n    };\n\n    clientOffset = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n\n    setOffset({ x: offset.x + browserOffset.x, y: offset.y + browserOffset.y })\n  }\n\n  const onMoveEnd = () => {\n    draggable = false;\n    let x = offset.x;\n    let y = offset.y;\n    if (Math.abs(offset.x) >= offsetRange.x) {\n      x = offset.x < 0 ? Math.min(0, -(offsetRange.x)) : Math.max(0, offsetRange.x);\n    }\n    if (Math.abs(offset.y) >= offsetRange.y) {\n      y = offset.y < 0 ? Math.min(0, -(offsetRange.y)) : Math.max(0, offsetRange.y);\n    }\n    setOffset({ x, y });\n  }\n\n  // TODO: new error image api\n  const onImageError = (e) => {\n    const { imgUrl } = this.props;\n    const largeURl = imgUrl.replace('_original', '');\n    e.target.src = largeURl;\n  }\n\n  const setOffsetRange = () => {\n    /**\n     * (bnikom) let's explain my logic here, shall we?\n     *\n     * 2 formulas:\n     * 1. (zoom * length) - (length * (((zoom - 1)/2) + 1))\n     * 2. (length * (((zoom - 1)/2) + 1)) - length\n     *\n     * (zoom - 1): the scale starts at 1, but initial image should not move at scale == 1\n     * we need our calculations to start at 0 #IndexStartsAt0\n     *\n     * (zoom - 1) / 2: when you increase zoom, you are adding 0.5 to each side\n     * ex. increasing the zoom from 1 to 2, you're adding 0.5 to each side\n     *\n     * (1 + ((zoom - 1) / 2): adding the initia1 (100%) of the starting scale\n     *\n     * length * (1 + ((zoom - 1) / 2): multiply by original length to find offset\n     *\n     * (length * (((zoom - 1)/2) + 1)): length - to find out our offset we need to subtract the original length\n     * and see how much we have to move\n     *               OR\n     * (zoom * length) - (length * (((zoom - 1)/2) + 1)): subract calculated width from width of zoomed pic\n    */\n\n    const dx = (imgEl.offsetWidth * (1 + ((zoom - 1) / 2))) - imgEl.offsetWidth;\n    const dy = (imgEl.offsetHeight * (1 + ((zoom - 1) / 2))) - imgEl.offsetHeight;\n    offsetRange = {\n      x: Math.max(0, dx),\n      y: Math.max(0, dy),\n    };\n  }\n\n  const resetOffset = () => {\n    setOffset(OFFSET_DEFAULT);\n  }\n\n  const zoomImg = e => {\n    if (e.deltaY > 0) {\n      zoomIn(0.1);\n      e.preventDefault();\n    } else if (e.deltaY < 0) {\n      zoomOut(0.1);\n      e.preventDefault();\n    }\n  }\n\n  const zoomIn = (level) => {\n    setZoom(Math.min(zoom + level, ZOOM_LEVEL.MAX));\n    setOffset(OFFSET_DEFAULT);\n\n    // TODO: POTENTIAL CALLBACK NEEDED\n    setOffsetRange();\n    // this.setState({ zoom: Math.min(this.state.zoom + level, ZOOM_LEVEL.MAX), offset: OFFSET_DEFAULT }, () => {\n    //   this.setOffsetRange();\n    // });\n  }\n\n  const zoomOut = (level) => {\n    if (Math.max(1, zoom - level) > 1) {\n\n      // this.setState({ zoom: Math.max(1, this.state.zoom - level), offset: OFFSET_DEFAULT }, () => {\n      //   this.setOffsetRange();\n      // });\n      setZoom(Math.max(1, zoom - level));\n      setOffset(OFFSET_DEFAULT);\n\n      setOffsetRange();\n    } else {\n      setZoom(Math.max(1, zoom - level));\n      resetOffset();\n      // this.setState({ zoom: Math.max(1, this.state.zoom - level) }, () => {\n      //   this.resetOffset();\n      // });\n    }\n  }\n\n  const handleClickOutside = (e) => {\n    // (bnikom) finding the modal parent of the react component\n    const modalBody = document.body.querySelector('#modalImgBody');\n\n    if (modalBody && !modalBody.contains(e.target)) {\n      // (bnikom) I want this to re-render when then modal is closed, so it doesn't look strange\n      // setTimeout(() => this.setState({ zoom: ZOOM_LEVEL.MIN, offset: OFFSET_DEFAULT }), 200);\n      setTimeout(() => setZoom(ZOOM_LEVEL.MIN), setOffset(OFFSET_DEFAULT) , 200);\n    }\n  }\n\n  const value = `translate3d(${offset.x}px, ${offset.y}px, 0px) scale(${zoom})`;\n\n  return (\n    <Row className=\"main-img-row\">\n      <Col\n        className=\"tool-bar col-xs-1\"\n      >\n        <Row>\n          <Col className=\"zoom-button-group align-middle col-xs-6\">\n            <button\n              className=\"zoom-in btn\"\n              onClick={() => zoomIn(1)}\n              disabled={zoom >= ZOOM_LEVEL.MAX}\n            >\n              <span className=\"fa fa-search-plus fa-2x\" />\n            </button>\n            <button\n              className=\"zoom-out btn\"\n              onClick={() => zoomOut(1)}\n              disabled={zoom <= ZOOM_LEVEL.MIN}\n            >\n              <span className=\"fa fa-search-minus fa-2x\" />\n            </button>\n          </Col>\n        </Row>\n      </Col>\n      <Col className=\"image-viewer col-xs-11 pull-right\">\n        <div className=\"image-wrapper block img-popup\">\n          <div\n            className=\"image-outer\"\n            role=\"presentation\"\n            draggable={false}\n            onDragStart={e => e.preventDefault()}\n            onMouseMove={e => onMove(e)}\n            onMouseDown={e => onMoveStart(e)}\n            onMouseUp={e => onMoveEnd(e)}\n            onWheel={e => zoomImg(e)}\n          >\n            <img\n              className=\"reactImg\"\n              id=\"imgPopup\"\n              ref={imgEl}\n              src={imgUrl}\n              onError={e => onImageError(e)}\n              alt={imgTitle}\n              style={{ cursor: zoom > 1 ? 'all-scroll' : 'default', transform: value }}\n            />\n          </div>\n        </div>\n      </Col>\n    </Row>\n  );\n}\n\nexport default ImageZoom;\n\n// function imageZoom(imgUrl, imgTitle) {\n//   if (document.getElementById('reactField')) {\n//     ReactDOM.render(\n//       <ImageZoom\n//         imgUrl={imgUrl}\n//         imgTitle={imgTitle}\n//       />, document.getElementById('reactField')\n//     );\n//   }\n// }\n\n// module.exports = imageZoom;\n"]},"metadata":{},"sourceType":"module"}